[[server]]
name = "Nextcloud"
[server.config]
address = "https://10.10.10.12:8120"
enabled = true

##

[[server]]
name = "Proxmox-Komodo"
[server.config]
address = "https://periphery:8120"
enabled = true

##

[[stack]]
name = "caddy"
[stack.config]
server = "Proxmox-Komodo"
auto_update = true
auto_update_all_services = true
linked_repo = "Homelab"
run_directory = "stacks/caddy"
environment = """
CADDY_BASE_DOMAIN=[[CADDY_BASE_DOMAIN]]
CADDY_BASE_DOMAIN2=[[CADDY_BASE_DOMAIN2]]
CADDY_CLOUDFLARE_API=[[CADDY_CLOUDFLARE_API]]
NFS_DEVICE=[[NFS_DEVICE]]
NFS_O=[[NFS_O]]
CADDY_NEXTCLOUD_DOMAIN=[[CADDY_NEXTCLOUD_DOMAIN]]
"""

##

[[stack]]
name = "emby"
[stack.config]
server = "Proxmox-Komodo"
auto_update = true
auto_update_all_services = true
linked_repo = "Homelab"
run_directory = "stacks/emby"
environment = """
NFS_DEVICE=[[NFS_DEVICE]]
NFS_DEVICE_MEDIA=[[NFS_DEVICE_MEDIA]]
NFS_O=[[NFS_O]]
"""

##

[[stack]]
name = "frigate"
[stack.config]
server = "Proxmox-Komodo"
auto_update = true
auto_update_all_services = true
linked_repo = "Homelab"
run_directory = "stacks/frigate"

##

[[stack]]
name = "navidrome"
[stack.config]
server = "Proxmox-Komodo"
auto_update = true
auto_update_all_services = true
linked_repo = "Homelab"
run_directory = "stacks/navidrome"
environment = """
NFS_DEVICE=[[NFS_DEVICE]]
NFS_O=[[NFS_O]]
"""

##

[[stack]]
name = "nextcloud"
[stack.config]
server = "Nextcloud"
auto_update = true
auto_update_all_services = true
linked_repo = "Homelab"
run_directory = "stacks/nextcloud"
environment = """
NFS_DEVICE=[[NFS_DEVICE]]
NFS_O=[[NFS_O]]
"""

##

[[stack]]
name = "openwebui"
[stack.config]
server = "Proxmox-Komodo"
auto_update = true
auto_update_all_services = true
linked_repo = "Homelab"
run_directory = "stacks/openwebui"

##

[[stack]]
name = "wgeasy"
[stack.config]
server = "Proxmox-Komodo"
auto_update = true
auto_update_all_services = true
linked_repo = "Homelab"
run_directory = "stacks/easy-wireguard"
environment = """
NFS_DEVICE=[[NFS_DEVICE]]
NFS_O=[[NFS_O]]
WG_HOST=[[WG_HOST]]
"""

##

[[repo]]
name = "Homelab"
[repo.config]
server = "Proxmox-Komodo"
builder = "local"
git_account = "github.wish887@slmail.me"
repo = "ZaCarrie/homelab"

##

[[procedure]]
name = "pull repo then redeploy on changes"
config.schedule = "1 */5 * * * *"
config.schedule_format = "Cron"

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "PullRepo", execution.params.repo = "Homelab", enabled = true }
]

[[procedure.config.stage]]
name = "Stage 2"
enabled = false
executions = [
  { execution.type = "RunSync", execution.params.sync = "Github", enabled = true }
]

[[procedure.config.stage]]
name = "Stage 3"
enabled = true
executions = [
  { execution.type = "BatchDeployStackIfChanged", execution.params.pattern = "*", enabled = true }
]

##

[[procedure]]
name = "run github sync"
config.schedule = "1 */10 * * * *"

[[procedure.config.stage]]
name = "Stage 1"
enabled = true
executions = [
  { execution.type = "RunSync", execution.params.sync = "Github", enabled = true }
]

##

[[builder]]
name = "local"
[builder.config]
type = "Server"
params.server_id = "Proxmox-Komodo"

##

[[resource_sync]]
name = "Github"
[resource_sync.config]
repo = "ZaCarrie/homelab"
git_account = "github.wish887@slmail.me"
resource_path = ["komodo.toml"]
managed = true